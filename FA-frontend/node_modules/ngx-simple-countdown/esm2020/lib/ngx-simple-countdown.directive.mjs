import { Directive, Input, Output, EventEmitter } from '@angular/core';
import { interval, ReplaySubject } from 'rxjs';
import { tap, takeUntil, filter } from 'rxjs/operators';
import { getDateNow, getCountdownResult, getLanguage } from './utils';
import * as i0 from "@angular/core";
export class NgxSimpleCountdownDirective {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.endMessage = 'countdown finish';
        this.language = 'en';
        this.reactive = true;
        this.styles = 'font-size:20px;color:#FFF;background-color:#000;padding:10px 5px;font-weight:bold;min-width:40px;text-align:center;';
        this.finish = new EventEmitter();
    }
    ngOnInit() {
        this.dateNow = getDateNow();
        this.keywords = getLanguage(this.language);
        this.initSimpleCountdown();
    }
    ngOnDestroy() { }
    initSimpleCountdown() {
        this.totalSecondes = this.dateTo - this.dateNow;
        this.updateSimpleCountdown(this.totalSecondes);
        this.interval$ = interval(1000).pipe(takeUntil(this.componentDestroyed(this)), filter((_) => this.reactive && this.totalSecondes > 0), tap((_) => {
            this.totalSecondes--;
            this.updateSimpleCountdown(this.totalSecondes);
        }));
        if (this.reactive) {
            this.interval$.subscribe();
        }
    }
    createHTML(data) {
        const { day, hours, minutes, seconds } = data;
        let o = '';
        if (this.totalSecondes > 0) {
            o = '<div style="display:flex;">';
            if (day > 0) {
                o += `<div style="${this.styles}">
          ${day}${this.keywords.day}
          </div>`;
            }
            if (hours > 0 || day > 0) {
                o += `<div style="${this.styles}">
          ${hours}${this.keywords.hours}
        </div>`;
            }
            if ((minutes > 0 || hours > 0 || day > 0) && this.reactive) {
                o += `<div style="${this.styles}">
          ${minutes}${this.keywords.minutes}
        </div>`;
            }
            if ((seconds > 0 || minutes > 0 || hours > 0 || day > 0) &&
                this.reactive) {
                o += `<div style="${this.styles}">
          ${seconds}${this.keywords.seconds}
        </div>`;
            }
            o += '</div>';
        }
        else {
            this.finish.emit();
            if (this.endMessage !== '') {
                o += `<div style="${this.styles}">${this.endMessage}</div>`;
            }
        }
        this.elementRef.nativeElement.innerHTML = o;
    }
    updateSimpleCountdown(secondes) {
        const countdownResult = getCountdownResult(secondes);
        this.createHTML(countdownResult);
    }
    componentDestroyed(component) {
        const oldNgOnDestroy = component.ngOnDestroy;
        const destroyed$ = new ReplaySubject(1);
        component.ngOnDestroy = () => {
            oldNgOnDestroy.apply(component);
            destroyed$.next(undefined);
            destroyed$.complete();
        };
        return destroyed$;
    }
}
NgxSimpleCountdownDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.9", ngImport: i0, type: NgxSimpleCountdownDirective, deps: [{ token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Directive });
NgxSimpleCountdownDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.3.9", type: NgxSimpleCountdownDirective, selector: "[simpleCountdown]", inputs: { dateTo: "dateTo", endMessage: "endMessage", language: "language", reactive: "reactive", styles: "styles" }, outputs: { finish: "finish" }, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.9", ngImport: i0, type: NgxSimpleCountdownDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[simpleCountdown]'
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }]; }, propDecorators: { dateTo: [{
                type: Input
            }], endMessage: [{
                type: Input
            }], language: [{
                type: Input
            }], reactive: [{
                type: Input
            }], styles: [{
                type: Input
            }], finish: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNpbXBsZS1jb3VudGRvd24uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXNpbXBsZS1jb3VudGRvd24vc3JjL2xpYi9uZ3gtc2ltcGxlLWNvdW50ZG93bi5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBSUwsTUFBTSxFQUNOLFlBQVksRUFDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFjLGFBQWEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMzRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUd4RCxPQUFPLEVBQUUsVUFBVSxFQUFFLGtCQUFrQixFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQzs7QUFJdEUsTUFBTSxPQUFPLDJCQUEyQjtJQWdCdEMsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQWRqQyxlQUFVLEdBQUcsa0JBQWtCLENBQUM7UUFDaEMsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLFdBQU0sR0FDYixxSEFBcUgsQ0FBQztRQUU5RyxXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFFLENBQUM7SUFRYixDQUFDO0lBRTlDLFFBQVE7UUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVUsRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxRQUFRLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQsV0FBVyxLQUFJLENBQUM7SUFFUixtQkFBbUI7UUFDekIsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElB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QUFTLENBQUMsV0FBVyxDQUFDO1FBQzdDLE1BQU0sVUFBVSxHQUFHLElBQUksYUFBYSxDQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzlDLFNBQVMsQ0FBQyxXQUFXLEdBQUcsR0FBRyxFQUFFO1lBQzNCLGNBQWMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDaEMsVUFBVSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzQixVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDeEIsQ0FBQyxDQUFDO1FBQ0YsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQzs7d0hBdEdVLDJCQUEyQjs0R0FBM0IsMkJBQTJCOzJGQUEzQiwyQkFBMkI7a0JBSHZDLFNBQVM7bUJBQUM7b0JBQ1QsUUFBUSxFQUFFLG1CQUFtQjtpQkFDOUI7aUdBRVUsTUFBTTtzQkFBZCxLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csUUFBUTtzQkFBaEIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFHSSxNQUFNO3NCQUFmLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBEaXJlY3RpdmUsXG4gIElucHV0LFxuICBFbGVtZW50UmVmLFxuICBPbkRlc3Ryb3ksXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBpbnRlcnZhbCwgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgdGFwLCB0YWtlVW50aWwsIGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgQ291bnRkb3duUmVzdWx0LCBDb3VudGRvd25LZXl3b3JkcyB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGdldERhdGVOb3csIGdldENvdW50ZG93blJlc3VsdCwgZ2V0TGFuZ3VhZ2UgfSBmcm9tICcuL3V0aWxzJztcbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tzaW1wbGVDb3VudGRvd25dJ1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hTaW1wbGVDb3VudGRvd25EaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpIGRhdGVUbzogbnVtYmVyO1xuICBASW5wdXQoKSBlbmRNZXNzYWdlID0gJ2NvdW50ZG93biBmaW5pc2gnO1xuICBASW5wdXQoKSBsYW5ndWFnZSA9ICdlbic7XG4gIEBJbnB1dCgpIHJlYWN0aXZlID0gdHJ1ZTtcbiAgQElucHV0KCkgc3R5bGVzID1cbiAgICAnZm9udC1zaXplOjIwcHg7Y29sb3I6I0ZGRjtiYWNrZ3JvdW5kLWNvbG9yOiMwMDA7cGFkZGluZzoxMHB4IDVweDtmb250LXdlaWdodDpib2xkO21pbi13aWR0aDo0MHB4O3RleHQtYWxpZ246Y2VudGVyOyc7XG5cbiAgQE91dHB1dCgpIGZpbmlzaDogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHB1YmxpYyBjb3VudGRvd25SZXN1bHQ6IENvdW50ZG93blJlc3VsdDtcbiAgcHVibGljIGRhdGVOb3c6IG51bWJlcjtcbiAgcHVibGljIGludGVydmFsJDogT2JzZXJ2YWJsZTxudW1iZXI+O1xuICBwdWJsaWMga2V5d29yZHM6IENvdW50ZG93bktleXdvcmRzO1xuICBwdWJsaWMgdG90YWxTZWNvbmRlczogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmRhdGVOb3cgPSBnZXREYXRlTm93KCk7XG4gICAgdGhpcy5rZXl3b3JkcyA9IGdldExhbmd1YWdlKHRoaXMubGFuZ3VhZ2UpO1xuICAgIHRoaXMuaW5pdFNpbXBsZUNvdW50ZG93bigpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7fVxuXG4gIHByaXZhdGUgaW5pdFNpbXBsZUNvdW50ZG93bigpOiB2b2lkIHtcbiAgICB0aGlzLnRvdGFsU2Vjb25kZXMgPSB0aGlzLmRhdGVUbyAtIHRoaXMuZGF0ZU5vdztcbiAgICB0aGlzLnVwZGF0ZVNpbXBsZUNvdW50ZG93bih0aGlzLnRvdGFsU2Vjb25kZXMpO1xuXG4gICAgdGhpcy5pbnRlcnZhbCQgPSBpbnRlcnZhbCgxMDAwKS5waXBlKFxuICAgICAgdGFrZVVudGlsKHRoaXMuY29tcG9uZW50RGVzdHJveWVkKHRoaXMpKSxcbiAgICAgIGZpbHRlcigoXykgPT4gdGhpcy5yZWFjdGl2ZSAmJiB0aGlzLnRvdGFsU2Vjb25kZXMgPiAwKSxcbiAgICAgIHRhcCgoXykgPT4ge1xuICAgICAgICB0aGlzLnRvdGFsU2Vjb25kZXMtLTtcbiAgICAgICAgdGhpcy51cGRhdGVTaW1wbGVDb3VudGRvd24odGhpcy50b3RhbFNlY29uZGVzKTtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIGlmICh0aGlzLnJlYWN0aXZlKSB7XG4gICAgICB0aGlzLmludGVydmFsJC5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUhUTUwoZGF0YTogQ291bnRkb3duUmVzdWx0KTogdm9pZCB7XG4gICAgY29uc3QgeyBkYXksIGhvdXJzLCBtaW51dGVzLCBzZWNvbmRzIH0gPSBkYXRhO1xuICAgIGxldCBvID0gJyc7XG5cbiAgICBpZiAodGhpcy50b3RhbFNlY29uZGVzID4gMCkge1xuICAgICAgbyA9ICc8ZGl2IHN0eWxlPVwiZGlzcGxheTpmbGV4O1wiPic7XG5cbiAgICAgIGlmIChkYXkgPiAwKSB7XG4gICAgICAgIG8gKz0gYDxkaXYgc3R5bGU9XCIke3RoaXMuc3R5bGVzfVwiPlxuICAgICAgICAgICR7ZGF5fSR7dGhpcy5rZXl3b3Jkcy5kYXl9XG4gICAgICAgICAgPC9kaXY+YDtcbiAgICAgIH1cblxuICAgICAgaWYgKGhvdXJzID4gMCB8fCBkYXkgPiAwKSB7XG4gICAgICAgIG8gKz0gYDxkaXYgc3R5bGU9XCIke3RoaXMuc3R5bGVzfVwiPlxuICAgICAgICAgICR7aG91cnN9JHt0aGlzLmtleXdvcmRzLmhvdXJzfVxuICAgICAgICA8L2Rpdj5gO1xuICAgICAgfVxuXG4gICAgICBpZiAoKG1pbnV0ZXMgPiAwIHx8IGhvdXJzID4gMCB8fCBkYXkgPiAwKSAmJiB0aGlzLnJlYWN0aXZlKSB7XG4gICAgICAgIG8gKz0gYDxkaXYgc3R5bGU9XCIke3RoaXMuc3R5bGVzfVwiPlxuICAgICAgICAgICR7bWludXRlc30ke3RoaXMua2V5d29yZHMubWludXRlc31cbiAgICAgICAgPC9kaXY+YDtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICAoc2Vjb25kcyA+IDAgfHwgbWludXRlcyA+IDAgfHwgaG91cnMgPiAwIHx8IGRheSA+IDApICYmXG4gICAgICAgIHRoaXMucmVhY3RpdmVcbiAgICAgICkge1xuICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj5cbiAgICAgICAgICAke3NlY29uZHN9JHt0aGlzLmtleXdvcmRzLnNlY29uZHN9XG4gICAgICAgIDwvZGl2PmA7XG4gICAgICB9XG4gICAgICBvICs9ICc8L2Rpdj4nO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZpbmlzaC5lbWl0KCk7XG4gICAgICBpZiAodGhpcy5lbmRNZXNzYWdlICE9PSAnJykge1xuICAgICAgICBvICs9IGA8ZGl2IHN0eWxlPVwiJHt0aGlzLnN0eWxlc31cIj4ke3RoaXMuZW5kTWVzc2FnZX08L2Rpdj5gO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmlubmVySFRNTCA9IG87XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNpbXBsZUNvdW50ZG93bihzZWNvbmRlczogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgY291bnRkb3duUmVzdWx0ID0gZ2V0Q291bnRkb3duUmVzdWx0KHNlY29uZGVzKTtcbiAgICB0aGlzLmNyZWF0ZUhUTUwoY291bnRkb3duUmVzdWx0KTtcbiAgfVxuXG4gIHByaXZhdGUgY29tcG9uZW50RGVzdHJveWVkKGNvbXBvbmVudDogT25EZXN0cm95KSB7XG4gICAgY29uc3Qgb2xkTmdPbkRlc3Ryb3kgPSBjb21wb25lbnQubmdPbkRlc3Ryb3k7XG4gICAgY29uc3QgZGVzdHJveWVkJCA9IG5ldyBSZXBsYXlTdWJqZWN0PHZvaWQ+KDEpO1xuICAgIGNvbXBvbmVudC5uZ09uRGVzdHJveSA9ICgpID0+IHtcbiAgICAgIG9sZE5nT25EZXN0cm95LmFwcGx5KGNvbXBvbmVudCk7XG4gICAgICBkZXN0cm95ZWQkLm5leHQodW5kZWZpbmVkKTtcbiAgICAgIGRlc3Ryb3llZCQuY29tcGxldGUoKTtcbiAgICB9O1xuICAgIHJldHVybiBkZXN0cm95ZWQkO1xuICB9XG59XG4iXX0=